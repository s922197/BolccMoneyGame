<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²¡å¯Œå°æ±ºï¼šç†è²¡ Roguelike (éš¨æ©Ÿå¼·åŒ–ç‰ˆ)</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #27ae60;
            --danger: #e74c3c;
            --bg: #ecf0f1;
            --card-bg: #fff;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--primary);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1, h2, h3 { margin: 0.5em 0; }
        .container {
            max-width: 1000px;
            width: 100%;
        }
        
        /* å„€è¡¨æ¿å€åŸŸ */
        .dashboard {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }
        .player-stats {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            flex: 1;
            border-top: 5px solid var(--accent);
            transition: transform 0.3s, border 0.3s;
        }
        .player-stats.active {
            transform: scale(1.05);
            border: 2px solid #3498db;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.4);
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 1.1em;
        }
        .money { color: var(--accent); font-weight: bold; }
        .debt { color: var(--danger); font-weight: bold; }
        .rate { color: #8e44ad; font-weight: bold; }

        /* éŠæˆ²è³‡è¨Š */
        .game-info {
            text-align: center;
            margin-bottom: 20px;
            background: #34495e;
            color: white;
            padding: 10px;
            border-radius: 8px;
        }

        /* å¡ç‰Œå€åŸŸ */
        .cards-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .card {
            background: var(--card-bg);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 160px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            border-color: var(--accent);
        }
        .card-title { font-weight: bold; margin-bottom: 10px; color: #2980b9; font-size: 1.1em; }
        .card-desc { font-size: 0.9em; color: #555; line-height: 1.4; }
        .card-type { 
            font-size: 0.75em; 
            text-transform: uppercase; 
            color: #aaa; 
            margin-top: 10px; 
            text-align: right;
            border-top: 1px solid #eee;
            padding-top: 5px;
        }

        /* äº‹ä»¶èˆ‡æ—¥èªŒ */
        .log-area {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            font-family: monospace;
        }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #eee; padding-bottom: 2px; }
        .log-turn { color: #e67e22; font-weight: bold; background: #fff3e0; padding: 2px 5px; }
        .log-event { color: #e74c3c; font-weight: bold; }
        .log-gain { color: var(--accent); }

        /* æŒ‰éˆ• */
        button.start-btn {
            padding: 15px 30px;
            font-size: 1.2em;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button.start-btn:hover { background: #219150; }

        .phase-indicator {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #d35400;
            margin: 10px 0;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="setup-screen" style="text-align: center; margin-top: 50px;">
        <h1>ğŸ’° è²¡å¯Œå°æ±º Roguelike</h1>
        <p>20 è¼ªæ±ºç­–ï¼Œå…©çµ„å°æŠ—ï¼Œèª°èƒ½æˆç‚ºæœ€çµ‚å¯Œè±ªï¼Ÿ</p>
        <p>åˆå§‹è³‡é‡‘ï¼š$100 | éŠ€è¡Œåˆ©ç‡ï¼š1% | ç”Ÿæ´»è²»ï¼š$10/è¼ª | åä¸€å¥‰ç»ï¼šæ”¶å…¥ 10%</p>
        <button class="start-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
    </div>

    <div id="game-screen" style="display: none;">
        <div class="game-info">
            <span id="turn-display">ç¬¬ 1 / 20 è¼ª</span>
        </div>

        <div class="phase-indicator" id="phase-display">ç­‰å¾…é–‹å§‹...</div>

        <div class="dashboard">
            <div class="player-stats" id="p1-stats">
                <h3>ğŸ‘¥ A çµ„</h3>
                <div class="stat-row">ç¾é‡‘: <span class="money" id="p1-cash">$100</span></div>
                <div class="stat-row">å­˜æ¬¾: <span class="money" id="p1-bank">$0</span></div>
                <div class="stat-row">åˆ©ç‡: <span class="rate" id="p1-rate">1.0%</span></div>
                <div class="stat-row">æœ¬è¼ªæ”¶å…¥: <span id="p1-income">$0</span></div>
                <div style="margin-top:10px; font-size:0.8em; color:#666;">
                    ç‹€æ…‹: <span id="p1-status">ç„¡</span>
                </div>
            </div>

            <div class="player-stats" id="p2-stats">
                <h3>ğŸ‘¥ B çµ„</h3>
                <div class="stat-row">ç¾é‡‘: <span class="money" id="p2-cash">$100</span></div>
                <div class="stat-row">å­˜æ¬¾: <span class="money" id="p2-bank">$0</span></div>
                <div class="stat-row">åˆ©ç‡: <span class="rate" id="p2-rate">1.0%</span></div>
                <div class="stat-row">æœ¬è¼ªæ”¶å…¥: <span id="p2-income">$0</span></div>
                <div style="margin-top:10px; font-size:0.8em; color:#666;">
                    ç‹€æ…‹: <span id="p2-status">ç„¡</span>
                </div>
            </div>
        </div>

        <div id="cards-container" class="cards-area">
            </div>

        <h3>ğŸ“ äº‹ä»¶æ—¥èªŒ</h3>
        <div class="log-area" id="game-log"></div>
    </div>
</div>

<script>
/**
 * éŠæˆ²é‚è¼¯æ ¸å¿ƒ
 */

const CONFIG = {
    maxTurns: 20,
    startCash: 100,
    livingCost: 10,
    titheRate: 0.1,
    baseRate: 0.01
};

let gameState = {
    turn: 1,
    phase: 'p1_choice', // p1_choice, p2_choice, processing
    players: [],
    logs: []
};

function createPlayer(name) {
    return {
        name: name,
        cash: CONFIG.startCash,
        bank: 0,
        rate: CONFIG.baseRate,
        tempRateBoost: 0, 
        activeJobs: [], 
        investments: [],
        lockedSavings: [],
        roundIncome: 0
    };
}

function startGame() {
    document.getElementById('setup-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'block';
    
    gameState.turn = 1;
    gameState.players = [createPlayer('A çµ„'), createPlayer('B çµ„')];
    gameState.phase = 'p1_choice';
    
    log("éŠæˆ²é–‹å§‹ï¼ç›®æ¨™æ˜¯20è¼ªå¾Œè³‡ç”¢æœ€é«˜ã€‚", 'turn');
    updateUI();
    generateCards(0); 
}

// ---------------------------------------------------------
// å¡ç‰Œç”Ÿæˆç³»çµ± (æ ¸å¿ƒä¿®æ”¹è™•)
// ---------------------------------------------------------

// å®šç¾©å„ç¨®é¡å‹çš„å¡ç‰Œç”Ÿæˆå™¨å‡½æ•¸ (æ¯æ¬¡å‘¼å«éƒ½æœƒè¿”å›æ–°çš„æ•¸å€¼)
const generators = {
    // 1. å·¥ä½œé¡
    jobLow: () => createJobCard("è‡¨æ™‚æ‰“å·¥", 20, 25, 2, 3), // çŸ­æœŸä½è–ª
    jobMid: () => createJobCard("ç©©å®šå…¼è·", 15, 20, 4, 6), // é•·æœŸç©©å®š
    jobHigh: () => createJobCard("é«˜è–ªåˆç´„", 35, 55, 2, 3), // é«˜è–ªçŸ­æœŸ

    // 2. éŠ€è¡Œæ“ä½œé¡
    deposit: () => {
        let v = randInt(20, 100);
        return {
            type: 'DEPOSIT',
            title: 'ğŸ’° å­˜å…¥éŠ€è¡Œ',
            val: v,
            desc: `å­˜å…¥ ${v} å…ƒ (è‹¥ç¾é‡‘ä¸è¶³å‰‡å­˜å…¥å…¨éƒ¨)ã€‚`,
            effect: (p) => {
                let amount = Math.min(p.cash, v);
                if (amount <= 0) return `ç¾é‡‘ä¸è¶³ï¼Œç„¡æ³•å­˜éŒ¢`;
                p.cash -= amount;
                p.bank += amount;
                return `å­˜å…¥äº† ${amount} å…ƒ`;
            }
        };
    },
    withdraw: () => {
        let v = randInt(20, 80);
        return {
            type: 'WITHDRAW',
            title: 'ğŸ§ å¾éŠ€è¡Œé ˜éŒ¢',
            val: v,
            desc: `é ˜å‡º ${v} å…ƒ (è‹¥å­˜æ¬¾ä¸è¶³å‰‡é ˜å‡ºå…¨éƒ¨)ã€‚`,
            effect: (p) => {
                let amount = Math.min(p.bank, v);
                if (amount <= 0) return `å­˜æ¬¾ä¸è¶³ï¼Œç„¡æ³•é ˜éŒ¢`;
                p.bank -= amount;
                p.cash += amount;
                return `é ˜å‡ºäº† ${amount} å…ƒ`;
            }
        };
    },
    rateBoost: () => {
        let v = randInt(10, 25) / 10; // 1.0% - 2.5%
        return {
            type: 'RATE',
            title: 'ğŸ“ˆ çˆ­å–åˆ©ç‡å„ªæƒ ',
            val: v,
            desc: `æœ¬è¼ªéŠ€è¡Œåˆ©ç‡è‡¨æ™‚å¢åŠ  ${v}% (åƒ…é™ä¸‹ä¸€è¼ªçµç®—)ã€‚`,
            effect: (p) => {
                p.tempRateBoost += (v / 100);
                return `ç²å¾—è‡¨æ™‚åˆ©ç‡åŠ æˆ +${v}%`;
            }
        };
    },
    lockSavings: () => {
        let amt = randInt(50, 100);
        let r = randInt(30, 50) / 10; // 3.0% - 5.0%
        let t = randInt(3, 5);
        return {
            type: 'LOCK',
            title: 'ğŸ”’ å®šæœŸå­˜å–®',
            val: { amt, r, t },
            desc: `é–å®šå­˜æ¬¾ ${amt} å…ƒï¼Œäº« ${r}% åˆ©ç‡ï¼ŒæŒçºŒ ${t} è¼ªã€‚`,
            effect: (p) => {
                if (p.bank < amt) return `éŠ€è¡Œå­˜æ¬¾ä¸è¶³ ${amt}ï¼Œäº¤æ˜“å¤±æ•—`;
                p.bank -= amt;
                p.lockedSavings.push({ amount: amt, rate: r / 100, turnsLeft: t });
                return `é–å®š ${amt} å…ƒé€²è¡Œå®šå­˜`;
            }
        };
    },
    
    // 3. æŠ•è³‡é¡
    invest: () => {
        let cost = randInt(40, 70);
        let roi = randInt(125, 160); // 125% - 160% å›å ±
        let wait = randInt(2, 4);
        return {
            type: 'INVEST',
            title: 'ğŸš€ é¢¨éšªæŠ•è³‡',
            val: { cost, roi, wait },
            desc: `èŠ±è²» ${cost} å…ƒï¼Œ${wait} è¼ªå¾Œå›æ”¶ ${Math.floor(cost * roi/100)} å…ƒã€‚æœ‰æ©Ÿç‡ç²é¡å¤–çå‹µã€‚`,
            effect: (p) => {
                if (p.cash < cost) return `ç¾é‡‘ä¸è¶³ ${cost}ï¼ŒæŠ•è³‡å¤±æ•—`;
                p.cash -= cost;
                let returnAmt = Math.floor(cost * (roi / 100));
                let bonus = Math.floor(cost * 0.5);
                p.investments.push({
                    returnAmount: returnAmt,
                    turnsLeft: wait,
                    bonusChance: 0.3,
                    bonusAmount: bonus
                });
                return `æŠ•è³‡ ${cost} å…ƒï¼Œé æœŸå›æ”¶ ${returnAmt}`;
            }
        };
    }
};

function generateCards(playerIndex) {
    const container = document.getElementById('cards-container');
    container.innerHTML = '';
    
    // å»ºç«‹å¡æ±  (Deck Building Strategy)
    // æˆ‘å€‘å°‡ã€Œç”Ÿæˆå™¨å‡½æ•¸ã€æ”¾å…¥é™£åˆ—ï¼Œè€Œä¸æ˜¯å¡ç‰Œç‰©ä»¶æœ¬èº«
    let deck = [];

    // 1. ä¿åº•å·¥ä½œå¡ (ç¢ºä¿å‰æœŸæœ‰éŒ¢è³º)
    // å‰ 5 è¼ªæ”¾å…¥è¼ƒå¤šå®¹æ˜“ä¸Šæ‰‹çš„å·¥ä½œ
    if (gameState.turn <= 5) {
        deck.push(generators.jobLow);
        deck.push(generators.jobLow);
        deck.push(generators.jobMid);
        deck.push(generators.jobHigh);
        deck.push(generators.deposit); 
    } else {
        deck.push(generators.jobMid);
        deck.push(generators.jobHigh);
    }

    // 2. éš¨æ©Ÿå¡«å……å‰©é¤˜å¡æ± 
    // é€™è£¡æˆ‘å€‘å®šç¾©æ¬Šé‡ï¼Œé‡è¤‡ push ç”Ÿæˆå™¨é€²å»ï¼Œå¢åŠ æŠ½ä¸­æ©Ÿç‡
    const pool = [
        generators.jobLow, generators.jobMid, generators.jobHigh, // å·¥ä½œ
        generators.deposit, generators.deposit, // å­˜æ¬¾ (å¤šæ”¾ä¸€é»)
        generators.withdraw, generators.withdraw, // ææ¬¾
        generators.rateBoost, 
        generators.lockSavings, 
        generators.invest
    ];

    // å¾ pool éš¨æ©ŸæŠ“ 10 å€‹æ”¾é€² deck æ··æ´—
    for(let i=0; i<10; i++) {
        deck.push(pool[Math.floor(Math.random() * pool.length)]);
    }

    // æ´—ç‰Œ (Fisher-Yates Shuffle)
    for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
    }

    // å–å‰ 5 å¼µä¸¦ã€Œå¯¦ä¾‹åŒ–ã€(åŸ·è¡Œç”Ÿæˆå™¨å‡½æ•¸)
    // é€™ä¸€æ­¥è‡³é—œé‡è¦ï¼šå³ä½¿ deck[0] å’Œ deck[1] éƒ½æ˜¯ generators.jobLowï¼Œ
    // åŸ·è¡Œå…©æ¬¡æœƒå¾—åˆ°å…©å€‹æ•¸å€¼ä¸åŒçš„å¡ç‰Œç‰©ä»¶ã€‚
    let finalCards = deck.slice(0, 5).map(genFunc => genFunc());

    // æ¸²æŸ“å¡ç‰Œ
    finalCards.forEach((card) => {
        let div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <div>
                <div class="card-title">${card.title}</div>
                <div class="card-desc">${card.desc}</div>
            </div>
            <div class="card-type">${card.type}</div>
        `;
        div.onclick = () => makeChoice(playerIndex, card);
        container.appendChild(div);
    });
}

function createJobCard(title, minPay, maxPay, minTurn, maxTurn) {
    let pay = randInt(minPay, maxPay);
    let turns = randInt(minTurn, maxTurn);
    return {
        type: 'JOB',
        title: `ğŸ’¼ ${title}`,
        val: { pay, turns },
        desc: `ç²å¾—å·¥ä½œï¼Œæ¯è¼ªæ”¶å…¥ ${pay} å…ƒï¼ŒæŒçºŒ ${turns} è¼ªã€‚`,
        effect: (p) => {
            p.activeJobs.push({ income: pay, turnsLeft: turns });
            return `ç²å¾—å·¥ä½œï¼š$${pay}/è¼ª`;
        }
    };
}

// ---------------------------------------------------------
// ä»¥ä¸‹é‚è¼¯ç¶­æŒä¸è®Š
// ---------------------------------------------------------

function makeChoice(playerIndex, option) {
    let player = gameState.players[playerIndex];
    // åŸ·è¡Œæ•ˆæœæ™‚ä¸éœ€è¦å‚³ option.valï¼Œå› ç‚ºç¾åœ¨ effect å‡½æ•¸å…§éƒ¨å·²ç¶“é–‰åŒ…ç¶å®šäº†ç•¶ä¸‹çš„æ•¸å€¼
    // ä½†ç‚ºäº†ä¿æŒèˆŠæœ‰çµæ§‹ç›¸å®¹ï¼Œæˆ‘å€‘æª¢æŸ¥åƒæ•¸
    let result = option.effect(player); 
    
    log(`${player.name} é¸æ“‡ [${option.title}]ï¼š${result}`);
    
    if (playerIndex === 0) {
        gameState.phase = 'p2_choice';
        updateUI();
        generateCards(1);
    } else {
        gameState.phase = 'processing';
        updateUI();
        document.getElementById('cards-container').innerHTML = '<h2 style="text-align:center; width:100%;">çµç®—ä¸­...</h2>';
        setTimeout(processTurn, 800);
    }
}

function processTurn() {
    log(`--- ç¬¬ ${gameState.turn} è¼ªçµç®— ---`, 'turn');
    handleRandomEvents();

    gameState.players.forEach(p => {
        p.roundIncome = 0; 
        let logs = [];

        // å·¥ä½œæ”¶å…¥
        if (p.activeJobs.length > 0) {
            let jobIncome = 0;
            p.activeJobs.forEach(j => {
                jobIncome += j.income;
                j.turnsLeft--;
            });
            p.activeJobs = p.activeJobs.filter(j => j.turnsLeft > 0);
            p.roundIncome += jobIncome;
            p.cash += jobIncome;
            logs.push(`å·¥ä½œæ”¶å…¥ +$${jobIncome}`);
        }

        // æŠ•è³‡å›æ”¶
        if (p.investments.length > 0) {
            let invIncome = 0;
            p.investments.forEach(inv => {
                inv.turnsLeft--;
                if (inv.turnsLeft === 0) {
                    invIncome += inv.returnAmount;
                    if (Math.random() < inv.bonusChance) {
                        invIncome += inv.bonusAmount;
                        logs.push(`âœ¨ æŠ•è³‡å¤§è³ºï¼é¡å¤–ç²å¾— +$${inv.bonusAmount}`);
                    }
                }
            });
            p.investments = p.investments.filter(inv => inv.turnsLeft > 0);
            if (invIncome > 0) {
                p.roundIncome += invIncome;
                p.cash += invIncome;
                logs.push(`æŠ•è³‡å›æ”¶ +$${invIncome}`);
            }
        }

        // å®šå­˜åˆ©æ¯
        if (p.lockedSavings.length > 0) {
            let lockIncome = 0;
            let releasedPrincipal = 0;
            p.lockedSavings.forEach(l => {
                let interest = Math.floor(l.amount * l.rate);
                p.roundIncome += interest;
                p.cash += interest;
                lockIncome += interest;
                
                l.turnsLeft--;
                if (l.turnsLeft === 0) {
                    releasedPrincipal += l.amount;
                }
            });
            p.lockedSavings = p.lockedSavings.filter(l => l.turnsLeft > 0);
            if (lockIncome > 0) logs.push(`å®šå­˜åˆ©æ¯ +$${lockIncome}`);
            if (releasedPrincipal > 0) {
                p.bank += releasedPrincipal;
                logs.push(`å®šå­˜æœ¬é‡‘è§£é– +$${releasedPrincipal}`);
            }
        }

        // åä¸€å¥‰ç»
        if (p.roundIncome > 0) {
            let tithe = Math.floor(p.roundIncome * CONFIG.titheRate);
            p.cash -= tithe;
            logs.push(`åä¸€å¥‰ç» -$${tithe}`);
        }

        // ç”Ÿæ´»è²»
        p.cash -= CONFIG.livingCost;

        // æ´»å­˜åˆ©æ¯
        let currentRate = p.rate + p.tempRateBoost;
        let bankInterest = Math.floor(p.bank * currentRate);
        if (bankInterest > 0) {
            p.bank += bankInterest;
            logs.push(`éŠ€è¡Œåˆ©æ¯(${(currentRate*100).toFixed(1)}%) +$${bankInterest}`);
        }
        p.tempRateBoost = 0;

        // ç ´ç”¢ä¿è­·
        if (p.cash < 0) {
            let needed = -p.cash;
            if (p.bank >= needed) {
                p.bank -= needed;
                p.cash = 0;
                logs.push(`âš ï¸ ç¾é‡‘ä¸è¶³ï¼ŒéŠ€è¡Œè‡ªå‹•è½‰å¸³ $${needed}`);
            } else {
                p.cash += p.bank;
                p.bank = 0;
                logs.push(`âŒ åš´é‡è²¡å‹™å±æ©Ÿï¼è² å‚µ $${p.cash}`);
            }
        }

        if (logs.length > 0) log(`${p.name}: ${logs.join(', ')}`);
    });

    gameState.turn++;
    if (gameState.turn > CONFIG.maxTurns) {
        endGame();
    } else {
        gameState.phase = 'p1_choice';
        updateUI();
        generateCards(0);
    }
}

function handleRandomEvents() {
    if (Math.random() > 0.3) return;
    const events = [
        { text: "ğŸ˜· æµæ„Ÿä¾†è¥²ï¼Œçœ‹é†«ç”ŸèŠ±è²» $20ã€‚", effect: (p) => { p.cash -= 20; return "-$20"; } },
        { text: "ğŸ‰ ç™¼ç¥¨ä¸­çï¼ç²å¾— $30ã€‚", effect: (p) => { p.cash += 30; return "+$30"; } },
        { text: "ğŸ“‰ ç¶“æ¿Ÿä¸æ™¯æ°£ï¼ŒéŠ€è¡Œé™æ¯ã€‚", effect: (p) => { p.tempRateBoost -= 0.005; return "æœ¬è¼ªåˆ©ç‡ -0.5%"; } },
        { text: "ğŸŒ§ï¸ é¢±é¢¨ä¿®ç¹•è²» $15ã€‚", effect: (p) => { p.cash -= 15; return "-$15"; } }
    ];
    let evt = events[Math.floor(Math.random() * events.length)];
    log(`[çªç™¼äº‹ä»¶] ${evt.text}`, 'event');
    gameState.players.forEach(p => {
        let res = evt.effect(p);
        log(`${p.name} å—åˆ°å½±éŸ¿: ${res}`);
    });
}

function endGame() {
    document.getElementById('cards-container').innerHTML = '';
    document.getElementById('phase-display').innerText = "éŠæˆ²çµæŸ";
    
    let p1Total = gameState.players[0].cash + gameState.players[0].bank + getLockedAssets(gameState.players[0]);
    let p2Total = gameState.players[1].cash + gameState.players[1].bank + getLockedAssets(gameState.players[1]);
    
    let winner = "";
    if (p1Total > p2Total) winner = "ğŸ† A çµ„ç²å‹ï¼";
    else if (p2Total > p1Total) winner = "ğŸ† B çµ„ç²å‹ï¼";
    else winner = "ğŸ¤ å¹³æ‰‹ï¼";

    let resultHTML = `
        <div style="text-align:center; background:white; padding:20px; border-radius:10px;">
            <h2>${winner}</h2>
            <p>A çµ„ç¸½è³‡ç”¢: <span class="money">$${p1Total}</span></p>
            <p>B çµ„ç¸½è³‡ç”¢: <span class="money">$${p2Total}</span></p>
            <button class="start-btn" onclick="location.reload()">é‡æ–°é–‹å§‹</button>
        </div>
    `;
    document.getElementById('cards-container').innerHTML = resultHTML;
}

function getLockedAssets(p) {
    let locked = 0;
    p.lockedSavings.forEach(l => locked += l.amount);
    return locked;
}

function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function log(msg, type = 'normal') {
    const logArea = document.getElementById('game-log');
    const div = document.createElement('div');
    div.className = 'log-entry';
    if (type === 'turn') div.className += ' log-turn';
    if (type === 'event') div.className += ' log-event';
    div.innerText = msg;
    logArea.prepend(div);
}

function updateUI() {
    document.getElementById('turn-display').innerText = `ç¬¬ ${gameState.turn} / ${CONFIG.maxTurns} è¼ª`;
    
    const phases = {
        'p1_choice': 'è«‹ A çµ„é¸æ“‡è¡Œå‹•',
        'p2_choice': 'è«‹ B çµ„é¸æ“‡è¡Œå‹•',
        'processing': 'çµç®—ä¸­...'
    };
    document.getElementById('phase-display').innerText = phases[gameState.phase];

    updatePlayerUI(0, 'p1');
    updatePlayerUI(1, 'p2');

    document.getElementById('p1-stats').classList.remove('active');
    document.getElementById('p2-stats').classList.remove('active');
    if (gameState.phase === 'p1_choice') document.getElementById('p1-stats').classList.add('active');
    if (gameState.phase === 'p2_choice') document.getElementById('p2-stats').classList.add('active');
}

function updatePlayerUI(idx, prefix) {
    let p = gameState.players[idx];
    document.getElementById(`${prefix}-cash`).innerText = `$${p.cash}`;
    document.getElementById(`${prefix}-bank`).innerText = `$${p.bank}`;
    let finalRate = (p.rate + p.tempRateBoost) * 100;
    document.getElementById(`${prefix}-rate`).innerText = `${finalRate.toFixed(1)}%`;
    document.getElementById(`${prefix}-income`).innerText = `$${p.roundIncome}`;
    
    let status = [];
    if (p.activeJobs.length > 0) status.push(`${p.activeJobs.length} ä»½å·¥ä½œ`);
    if (p.investments.length > 0) status.push(`${p.investments.length} ç­†æŠ•è³‡`);
    if (p.lockedSavings.length > 0) status.push(`${p.lockedSavings.length} ç­†å®šå­˜`);
    document.getElementById(`${prefix}-status`).innerText = status.length > 0 ? status.join(', ') : "ç„¡";
    
    if (p.cash < 0) document.getElementById(`${prefix}-cash`).classList.add('debt');
    else document.getElementById(`${prefix}-cash`).classList.remove('debt');
}
</script>

</body>
</html>
