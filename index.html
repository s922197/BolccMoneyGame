<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²¡å¯Œå°æ±ºï¼šç†è²¡ Roguelike</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #27ae60;
            --danger: #e74c3c;
            --bg: #ecf0f1;
            --card-bg: #fff;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--primary);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1, h2, h3 { margin: 0.5em 0; }
        .container {
            max-width: 1000px;
            width: 100%;
        }
        
        /* å„€è¡¨æ¿å€åŸŸ */
        .dashboard {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }
        .player-stats {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            flex: 1;
            border-top: 5px solid var(--accent);
        }
        .player-stats.active {
            transform: scale(1.02);
            border: 2px solid #3498db;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 1.1em;
        }
        .money { color: var(--accent); font-weight: bold; }
        .debt { color: var(--danger); font-weight: bold; }
        .rate { color: #8e44ad; font-weight: bold; }

        /* éŠæˆ²è³‡è¨Š */
        .game-info {
            text-align: center;
            margin-bottom: 20px;
            background: #34495e;
            color: white;
            padding: 10px;
            border-radius: 8px;
        }

        /* å¡ç‰Œå€åŸŸ */
        .cards-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .card {
            background: var(--card-bg);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 150px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            border-color: var(--accent);
        }
        .card-title { font-weight: bold; margin-bottom: 10px; color: #2980b9; }
        .card-desc { font-size: 0.9em; color: #555; }
        .card-type { 
            font-size: 0.8em; 
            text-transform: uppercase; 
            color: #999; 
            margin-top: 10px; 
            text-align: right;
        }

        /* äº‹ä»¶èˆ‡æ—¥èªŒ */
        .log-area {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            font-family: monospace;
        }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #eee; padding-bottom: 2px; }
        .log-turn { color: #e67e22; font-weight: bold; }
        .log-event { color: #e74c3c; font-weight: bold; }
        .log-gain { color: var(--accent); }

        /* æŒ‰éˆ• */
        button.start-btn {
            padding: 15px 30px;
            font-size: 1.2em;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button.start-btn:hover { background: #219150; }

        .phase-indicator {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #d35400;
            margin: 10px 0;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div id="setup-screen" style="text-align: center; margin-top: 50px;">
        <h1>ğŸ’° è²¡å¯Œå°æ±º Roguelike</h1>
        <p>20 è¼ªæ±ºç­–ï¼Œå…©çµ„å°æŠ—ï¼Œèª°èƒ½æˆç‚ºæœ€çµ‚å¯Œè±ªï¼Ÿ</p>
        <p>åˆå§‹è³‡é‡‘ï¼š$100 | éŠ€è¡Œåˆ©ç‡ï¼š1% | ç”Ÿæ´»è²»ï¼š$10/è¼ª | åä¸€å¥‰ç»ï¼šæ”¶å…¥ 10%</p>
        <button class="start-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
    </div>

    <div id="game-screen" style="display: none;">
        <div class="game-info">
            <span id="turn-display">ç¬¬ 1 / 20 è¼ª</span>
        </div>

        <div class="phase-indicator" id="phase-display">ç­‰å¾…é–‹å§‹...</div>

        <div class="dashboard">
            <div class="player-stats" id="p1-stats">
                <h3>ğŸ‘¥ A çµ„</h3>
                <div class="stat-row">ç¾é‡‘: <span class="money" id="p1-cash">$100</span></div>
                <div class="stat-row">å­˜æ¬¾: <span class="money" id="p1-bank">$0</span></div>
                <div class="stat-row">åˆ©ç‡: <span class="rate" id="p1-rate">1.0%</span></div>
                <div class="stat-row">æœ¬è¼ªæ”¶å…¥: <span id="p1-income">$0</span></div>
                <div style="margin-top:10px; font-size:0.8em; color:#666;">
                    ç‹€æ…‹: <span id="p1-status">ç„¡</span>
                </div>
            </div>

            <div class="player-stats" id="p2-stats">
                <h3>ğŸ‘¥ B çµ„</h3>
                <div class="stat-row">ç¾é‡‘: <span class="money" id="p2-cash">$100</span></div>
                <div class="stat-row">å­˜æ¬¾: <span class="money" id="p2-bank">$0</span></div>
                <div class="stat-row">åˆ©ç‡: <span class="rate" id="p2-rate">1.0%</span></div>
                <div class="stat-row">æœ¬è¼ªæ”¶å…¥: <span id="p2-income">$0</span></div>
                <div style="margin-top:10px; font-size:0.8em; color:#666;">
                    ç‹€æ…‹: <span id="p2-status">ç„¡</span>
                </div>
            </div>
        </div>

        <div id="cards-container" class="cards-area">
            </div>

        <h3>ğŸ“ äº‹ä»¶æ—¥èªŒ</h3>
        <div class="log-area" id="game-log"></div>
    </div>
</div>

<script>
/**
 * éŠæˆ²é‚è¼¯æ ¸å¿ƒ
 */

const CONFIG = {
    maxTurns: 20,
    startCash: 100,
    livingCost: 10,
    titheRate: 0.1,
    baseRate: 0.01
};

let gameState = {
    turn: 1,
    phase: 'p1_choice', // p1_choice, p2_choice, processing
    players: [],
    logs: []
};

// åˆå§‹åŒ–ç©å®¶ç‰©ä»¶çµæ§‹
function createPlayer(name) {
    return {
        name: name,
        cash: CONFIG.startCash,
        bank: 0,
        rate: CONFIG.baseRate,
        tempRateBoost: 0, // è‡¨æ™‚åˆ©ç‡åŠ æˆ
        activeJobs: [], // { income, turnsLeft }
        investments: [], // { returnAmount, turnsLeft, bonusChance, bonusAmount }
        lockedSavings: [], // { amount, rate, turnsLeft }
        roundIncome: 0 // ç•¶å‰è¼ªæ¬¡æ”¶å…¥ï¼ˆç”¨æ–¼è¨ˆç®—åä¸€ï¼‰
    };
}

function startGame() {
    document.getElementById('setup-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'block';
    
    gameState.turn = 1;
    gameState.players = [createPlayer('A çµ„'), createPlayer('B çµ„')];
    gameState.phase = 'p1_choice';
    
    log("éŠæˆ²é–‹å§‹ï¼ç›®æ¨™æ˜¯20è¼ªå¾Œè³‡ç”¢æœ€é«˜ã€‚");
    updateUI();
    generateCards(0); // ç‚ºç©å®¶ 0 ç”Ÿæˆå¡ç‰Œ
}

// ç”¢ç”Ÿéš¨æ©Ÿé¸é …
function generateCards(playerIndex) {
    const container = document.getElementById('cards-container');
    container.innerHTML = '';
    
    // å®šç¾©å¡ç‰Œæ± èˆ‡æ¬Šé‡
    // é¡å‹: JOB, DEPOSIT, RATE, WITHDRAW, LOCK, INVEST
    const options = [];
    
    // 1. å·¥ä½œ (åˆæœŸæ¬Šé‡é«˜)
    if (gameState.turn <= 5) {
        options.push(createJobCard(20, 30, 3, 5)); // ä½è–ªé•·å·¥
        options.push(createJobCard(30, 50, 2, 3)); // é«˜è–ªçŸ­å·¥
        options.push(createJobCard(15, 20, 5, 8)); // ç©©å®šå·¥ä½œ
    } else {
        options.push(createJobCard(30, 60, 2, 4));
    }

    // 2. å­˜æ¬¾/ææ¬¾/åˆ©ç‡
    options.push({
        type: 'DEPOSIT',
        title: 'ğŸ’° å­˜å…¥éŠ€è¡Œ',
        val: randInt(20, 100),
        desc: (v) => `å­˜å…¥ ${v} å…ƒ (è‹¥ç¾é‡‘ä¸è¶³å­˜å…¥å…¨éƒ¨)ã€‚`,
        effect: (p, v) => {
            let amount = Math.min(p.cash, v);
            if (amount <= 0) return `ç¾é‡‘ä¸è¶³ï¼Œç„¡æ³•å­˜éŒ¢`;
            p.cash -= amount;
            p.bank += amount;
            return `å­˜å…¥äº† ${amount} å…ƒ`;
        }
    });

    options.push({
        type: 'WITHDRAW',
        title: 'ğŸ§ å¾éŠ€è¡Œé ˜éŒ¢',
        val: randInt(20, 100),
        desc: (v) => `é ˜å‡º ${v} å…ƒ (è‹¥å­˜æ¬¾ä¸è¶³é ˜å‡ºå…¨éƒ¨)ã€‚`,
        effect: (p, v) => {
            let amount = Math.min(p.bank, v);
            if (amount <= 0) return `å­˜æ¬¾ä¸è¶³ï¼Œç„¡æ³•é ˜éŒ¢`;
            p.bank -= amount;
            p.cash += amount;
            return `é ˜å‡ºäº† ${amount} å…ƒ`;
        }
    });

    options.push({
        type: 'RATE',
        title: 'ğŸ“ˆ çˆ­å–åˆ©ç‡å„ªæƒ ',
        val: randInt(10, 30) / 10, // 1.0% - 3.0%
        desc: (v) => `æœ¬è¼ªéŠ€è¡Œåˆ©ç‡è‡¨æ™‚å¢åŠ  ${v}% (åƒ…é™ä¸‹ä¸€è¼ªçµç®—)ã€‚`,
        effect: (p, v) => {
            p.tempRateBoost += (v / 100);
            return `ç²å¾—è‡¨æ™‚åˆ©ç‡åŠ æˆ +${v}%`;
        }
    });

    // 3. é–å®šå„²è“„
    options.push({
        type: 'LOCK',
        title: 'ğŸ”’ å®šæœŸå­˜å–®',
        val: { amt: randInt(50, 100), rate: randInt(3, 6), turn: randInt(3, 5) },
        desc: (v) => `é–å®šå­˜æ¬¾ ${v.amt} å…ƒï¼Œäº« ${v.rate}% åˆ©ç‡ï¼ŒæŒçºŒ ${v.turn} è¼ªã€‚`,
        effect: (p, v) => {
            if (p.bank < v.amt) return `éŠ€è¡Œå­˜æ¬¾ä¸è¶³ ${v.amt}ï¼Œäº¤æ˜“å¤±æ•—`;
            p.bank -= v.amt;
            p.lockedSavings.push({
                amount: v.amt,
                rate: v.rate / 100,
                turnsLeft: v.turn
            });
            return `é–å®š ${v.amt} å…ƒé€²è¡Œå®šå­˜`;
        }
    });

    // 4. æŠ•è³‡
    options.push({
        type: 'INVEST',
        title: 'ğŸš€ é¢¨éšªæŠ•è³‡',
        val: { cost: randInt(30, 60), roi: randInt(120, 150), wait: randInt(2, 4) },
        desc: (v) => `èŠ±è²» ${v.cost} å…ƒï¼Œ${v.wait} è¼ªå¾Œå›æ”¶ ${Math.floor(v.cost * v.roi/100)} å…ƒã€‚æœ‰æ©Ÿç‡ç²é¡å¤–çå‹µã€‚`,
        effect: (p, v) => {
            if (p.cash < v.cost) return `ç¾é‡‘ä¸è¶³ ${v.cost}ï¼ŒæŠ•è³‡å¤±æ•—`;
            p.cash -= v.cost;
            let returnAmt = Math.floor(v.cost * (v.roi / 100));
            let bonus = Math.floor(v.cost * 0.5); // 50% é¡å¤–çå‹µ
            p.investments.push({
                returnAmount: returnAmt,
                turnsLeft: v.wait,
                bonusChance: 0.3, // 30% æ©Ÿç‡
                bonusAmount: bonus
            });
            return `æŠ•è³‡äº† ${v.cost} å…ƒï¼Œç­‰å¾…å›æ”¶`;
        }
    });

    // éš¨æ©Ÿé¸ 5 å€‹é¡¯ç¤º
    // ç‚ºäº†å¹³è¡¡ï¼Œå…ˆç¢ºä¿æœ‰è‡³å°‘ä¸€å€‹"å·¥ä½œ"é¸é …ï¼Œå¦‚æœæ˜¯å‰å¹¾è¼ª
    let choices = [];
    if (gameState.turn <= 5) {
        choices.push(options[0]); // å¼·åˆ¶åŠ å…¥ç¬¬ä¸€å€‹å·¥ä½œé¸é …
    }
    
    // å¡«å……å‰©é¤˜
    while (choices.length < 5) {
        let r = options[Math.floor(Math.random() * options.length)];
        // ç°¡å–®å»é‡ï¼šä¸å®Œå…¨ç²¾ç¢ºä½†å¤ ç”¨
        choices.push(r);
    }
    // éš¨æ©Ÿæ‰“äº‚
    choices.sort(() => Math.random() - 0.5);

    // æ¸²æŸ“å¡ç‰Œ
    choices.forEach((opt, idx) => {
        let div = document.createElement('div');
        div.className = 'card';
        // è§£ææè¿°
        let descText = typeof opt.desc === 'function' ? opt.desc(opt.val) : opt.desc;
        
        div.innerHTML = `
            <div>
                <div class="card-title">${opt.title}</div>
                <div class="card-desc">${descText}</div>
            </div>
            <div class="card-type">${opt.type}</div>
        `;
        div.onclick = () => makeChoice(playerIndex, opt);
        container.appendChild(div);
    });
}

function createJobCard(minPay, maxPay, minTurn, maxTurn) {
    let pay = randInt(minPay, maxPay);
    let turns = randInt(minTurn, maxTurn);
    return {
        type: 'JOB',
        title: 'ğŸ’¼ å…¼è·å·¥ä½œ',
        val: { pay: pay, turns: turns },
        desc: (v) => `ç²å¾—ä¸€ä»½å·¥ä½œï¼Œæ¯è¼ªæ”¶å…¥ ${v.pay} å…ƒï¼ŒæŒçºŒ ${v.turns} è¼ªã€‚`,
        effect: (p, v) => {
            p.activeJobs.push({ income: v.pay, turnsLeft: v.turns });
            return `ç²å¾—å·¥ä½œï¼š$${v.pay}/è¼ª`;
        }
    };
}

function makeChoice(playerIndex, option) {
    let player = gameState.players[playerIndex];
    let result = typeof option.effect === 'function' ? option.effect(player, option.val) : "ç„¡æ•ˆæœ";
    
    log(`${player.name} é¸æ“‡äº† [${option.title}]ï¼š${result}`);
    
    if (playerIndex === 0) {
        // A çµ„é¸å®Œæ› B çµ„
        gameState.phase = 'p2_choice';
        updateUI();
        generateCards(1);
    } else {
        // B çµ„é¸å®Œï¼Œé€²å…¥çµç®—
        gameState.phase = 'processing';
        updateUI();
        document.getElementById('cards-container').innerHTML = '<h2 style="text-align:center; width:100%;">çµç®—ä¸­...</h2>';
        setTimeout(processTurn, 1000);
    }
}

// å›åˆçµç®—é‚è¼¯
function processTurn() {
    log(`--- ç¬¬ ${gameState.turn} è¼ªçµç®— ---`, 'turn');
    
    // 1. éš¨æ©Ÿäº‹ä»¶ (å…±ç”¨)
    handleRandomEvents();

    gameState.players.forEach(p => {
        p.roundIncome = 0; // é‡ç½®æœ¬è¼ªæ”¶å…¥
        let logs = [];

        // 2. è™•ç†å·¥ä½œæ”¶å…¥
        if (p.activeJobs.length > 0) {
            let jobIncome = 0;
            p.activeJobs.forEach(j => {
                jobIncome += j.income;
                j.turnsLeft--;
            });
            p.activeJobs = p.activeJobs.filter(j => j.turnsLeft > 0);
            p.roundIncome += jobIncome;
            p.cash += jobIncome;
            logs.push(`å·¥ä½œæ”¶å…¥ +$${jobIncome}`);
        }

        // 3. è™•ç†æŠ•è³‡å›æ”¶
        if (p.investments.length > 0) {
            let invIncome = 0;
            p.investments.forEach(inv => {
                inv.turnsLeft--;
                if (inv.turnsLeft === 0) {
                    invIncome += inv.returnAmount;
                    // æš´æ“Šæª¢å®š
                    if (Math.random() < inv.bonusChance) {
                        invIncome += inv.bonusAmount;
                        logs.push(`âœ¨ æŠ•è³‡å¤§è³ºï¼é¡å¤–ç²å¾— +$${inv.bonusAmount}`);
                    }
                }
            });
            p.investments = p.investments.filter(inv => inv.turnsLeft > 0);
            if (invIncome > 0) {
                p.roundIncome += invIncome;
                p.cash += invIncome;
                logs.push(`æŠ•è³‡å›æ”¶ +$${invIncome}`);
            }
        }

        // 4. å®šå­˜åˆ©æ¯ (é–å®šè³‡é‡‘)
        if (p.lockedSavings.length > 0) {
            let lockIncome = 0;
            let releasedPrincipal = 0;
            p.lockedSavings.forEach(l => {
                let interest = Math.floor(l.amount * l.rate);
                // é€™è£¡è¨­è¨ˆç‚ºï¼šåˆ©æ¯æ¯è¼ªç™¼æ”¾åˆ°ç¾é‡‘ï¼Ÿé‚„æ˜¯æ»¾å…¥ï¼Ÿ
                // ç‚ºäº†ç°¡å–®ï¼Œåˆ©æ¯æ»¾å…¥æœ¬é‡‘ï¼Œæœ€å¾Œæ‰æ‹¿å›ï¼Œæˆ–è€…æ¯è¼ªçµ¦ç¾é‡‘ã€‚
                // æ ¹æ“šé¡Œç›® "æ¯è¼ªç²å¾—m%åˆ©ç‡"ï¼Œå‡è¨­åˆ©æ¯æ˜¯ç™¼å‡ºä¾†çš„
                p.roundIncome += interest; // åˆ©æ¯ç®—æ”¶å…¥
                p.cash += interest;
                lockIncome += interest;
                
                l.turnsLeft--;
                if (l.turnsLeft === 0) {
                    releasedPrincipal += l.amount;
                }
            });
            p.lockedSavings = p.lockedSavings.filter(l => l.turnsLeft > 0);
            if (lockIncome > 0) logs.push(`å®šå­˜åˆ©æ¯ +$${lockIncome}`);
            if (releasedPrincipal > 0) {
                p.bank += releasedPrincipal; // æœ¬é‡‘å›åˆ°æ´»å­˜
                logs.push(`å®šå­˜åˆ°æœŸæœ¬é‡‘è§£é– +$${releasedPrincipal}`);
            }
        }

        // 5. åä¸€å¥‰ç» (æ‰£é™¤æœ¬è¼ªæ”¶å…¥ 10%)
        if (p.roundIncome > 0) {
            let tithe = Math.floor(p.roundIncome * CONFIG.titheRate);
            p.cash -= tithe;
            logs.push(`åä¸€å¥‰ç» -$${tithe}`);
        }

        // 6. ç”Ÿæ´»è²»
        p.cash -= CONFIG.livingCost;
        // logs.push(`ç”Ÿæ´»è²» -$${CONFIG.livingCost}`);

        // 7. éŠ€è¡Œæ´»å­˜åˆ©æ¯
        let currentRate = p.rate + p.tempRateBoost;
        let bankInterest = Math.floor(p.bank * currentRate);
        if (bankInterest > 0) {
            p.bank += bankInterest;
            logs.push(`éŠ€è¡Œåˆ©æ¯(${(currentRate*100).toFixed(1)}%) +$${bankInterest}`);
        }
        
        // é‡ç½®è‡¨æ™‚åˆ©ç‡
        p.tempRateBoost = 0;

        // 8. ç ´ç”¢ä¿è­· / è² å‚µè™•ç†
        if (p.cash < 0) {
            let needed = -p.cash;
            if (p.bank >= needed) {
                p.bank -= needed;
                p.cash = 0;
                logs.push(`âš ï¸ ç¾é‡‘ä¸è¶³ï¼Œå¾éŠ€è¡Œè‡ªå‹•è½‰å¸³ $${needed}`);
            } else {
                // éŠ€è¡Œä¹Ÿä¸å¤ 
                p.cash += p.bank; // æŠŠéŠ€è¡Œå‰©çš„æ‹¿ä¾†æŠµå‚µ
                p.bank = 0;
                // æ­¤æ™‚ cash ä»æ˜¯è² çš„
                logs.push(`âŒ åš´é‡è²¡å‹™å±æ©Ÿï¼è² å‚µ $${p.cash}`);
            }
        }

        if (logs.length > 0) log(`${p.name}: ${logs.join(', ')}`);
    });

    gameState.turn++;
    
    if (gameState.turn > CONFIG.maxTurns) {
        endGame();
    } else {
        gameState.phase = 'p1_choice';
        updateUI();
        generateCards(0);
    }
}

function handleRandomEvents() {
    // 30% æ©Ÿç‡ç™¼ç”Ÿäº‹ä»¶
    if (Math.random() > 0.3) return;

    const events = [
        {
            text: "ğŸ˜· å­£ç¯€æ€§æµæ„Ÿçˆ†ç™¼ï¼Œå…¨é«”éœ€è¦çœ‹é†«ç”Ÿã€‚",
            effect: (p) => { p.cash -= 20; return "-$20"; }
        },
        {
            text: "ğŸ‰ çµ±ä¸€ç™¼ç¥¨ä¸­çï¼",
            effect: (p) => { p.cash += 30; return "+$30"; }
        },
        {
            text: "ğŸ“‰ å…¨çƒè‚¡å¸‚éœ‡ç›ªï¼ŒéŠ€è¡Œç·Šæ€¥é™æ¯ã€‚",
            effect: (p) => { p.tempRateBoost -= 0.005; return "æœ¬è¼ªåˆ©ç‡ -0.5%"; }
        },
        {
            text: "ğŸŒ§ï¸ é¢±é¢¨ä¾†è¥²ï¼Œæˆ¿å±‹ä¿®ç¹•è²»ç”¨ã€‚",
            effect: (p) => { p.cash -= 15; return "-$15"; }
        }
    ];

    let evt = events[Math.floor(Math.random() * events.length)];
    log(`[çªç™¼äº‹ä»¶] ${evt.text}`, 'event');
    
    gameState.players.forEach(p => {
        let res = evt.effect(p);
        log(`${p.name} å—åˆ°å½±éŸ¿: ${res}`);
    });
}

function endGame() {
    document.getElementById('cards-container').innerHTML = '';
    document.getElementById('phase-display').innerText = "éŠæˆ²çµæŸ";
    
    let p1Total = gameState.players[0].cash + gameState.players[0].bank + getLockedAssets(gameState.players[0]);
    let p2Total = gameState.players[1].cash + gameState.players[1].bank + getLockedAssets(gameState.players[1]);
    
    let winner = "";
    if (p1Total > p2Total) winner = "ğŸ† A çµ„ç²å‹ï¼";
    else if (p2Total > p1Total) winner = "ğŸ† B çµ„ç²å‹ï¼";
    else winner = "ğŸ¤ å¹³æ‰‹ï¼";

    let resultHTML = `
        <div style="text-align:center; background:white; padding:20px; border-radius:10px;">
            <h2>${winner}</h2>
            <p>A çµ„ç¸½è³‡ç”¢: <span class="money">$${p1Total}</span></p>
            <p>B çµ„ç¸½è³‡ç”¢: <span class="money">$${p2Total}</span></p>
            <button class="start-btn" onclick="location.reload()">é‡æ–°é–‹å§‹</button>
        </div>
    `;
    
    document.getElementById('cards-container').innerHTML = resultHTML;
}

// è¨ˆç®—é‚„åœ¨å®šå­˜æˆ–æŠ•è³‡è£¡çš„éŒ¢ï¼ˆç²—ç•¥ä¼°è¨ˆç¾å€¼ï¼‰
function getLockedAssets(p) {
    let locked = 0;
    p.lockedSavings.forEach(l => locked += l.amount);
    // æŠ•è³‡é‚„æ²’å›æ”¶çš„ç®—æˆæœ¬åƒ¹å›ä¾†å—ï¼Ÿé€™è£¡ç°¡å–®ç®—0ï¼Œå› ç‚ºé‚„æ²’å›æ”¶ï¼Œæˆ–è€…ç®—ä¸€åŠ
    // ç‚ºäº†é¼“å‹µçŸ­æœŸè®Šç¾ï¼ŒçµæŸæ™‚æœªå›æ”¶çš„æŠ•è³‡è¦–ç‚ºè™§æ(æˆ–åƒ…é€€å›æœ¬é‡‘50%)
    p.investments.forEach(i => locked += 0); 
    return locked;
}

// è¼”åŠ©å‡½å¼
function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function log(msg, type = 'normal') {
    const logArea = document.getElementById('game-log');
    const div = document.createElement('div');
    div.className = 'log-entry';
    if (type === 'turn') div.className += ' log-turn';
    if (type === 'event') div.className += ' log-event';
    div.innerText = msg;
    logArea.prepend(div);
}

function updateUI() {
    document.getElementById('turn-display').innerText = `ç¬¬ ${gameState.turn} / ${CONFIG.maxTurns} è¼ª`;
    
    const phases = {
        'p1_choice': 'è«‹ A çµ„é¸æ“‡è¡Œå‹•',
        'p2_choice': 'è«‹ B çµ„é¸æ“‡è¡Œå‹•',
        'processing': 'çµç®—ä¸­...'
    };
    document.getElementById('phase-display').innerText = phases[gameState.phase];

    // æ›´æ–° A çµ„ UI
    updatePlayerUI(0, 'p1');
    updatePlayerUI(1, 'p2');

    // é«˜äº®ç•¶å‰ç©å®¶
    document.getElementById('p1-stats').classList.remove('active');
    document.getElementById('p2-stats').classList.remove('active');
    if (gameState.phase === 'p1_choice') document.getElementById('p1-stats').classList.add('active');
    if (gameState.phase === 'p2_choice') document.getElementById('p2-stats').classList.add('active');
}

function updatePlayerUI(idx, prefix) {
    let p = gameState.players[idx];
    document.getElementById(`${prefix}-cash`).innerText = `$${p.cash}`;
    document.getElementById(`${prefix}-bank`).innerText = `$${p.bank}`;
    
    let finalRate = (p.rate + p.tempRateBoost) * 100;
    document.getElementById(`${prefix}-rate`).innerText = `${finalRate.toFixed(1)}%`;
    document.getElementById(`${prefix}-income`).innerText = `$${p.roundIncome}`;
    
    let status = [];
    if (p.activeJobs.length > 0) status.push(`${p.activeJobs.length} ä»½å·¥ä½œ`);
    if (p.investments.length > 0) status.push(`${p.investments.length} ç­†æŠ•è³‡`);
    if (p.lockedSavings.length > 0) status.push(`${p.lockedSavings.length} ç­†å®šå­˜`);
    
    document.getElementById(`${prefix}-status`).innerText = status.length > 0 ? status.join(', ') : "ç„¡";
    
    if (p.cash < 0) {
        document.getElementById(`${prefix}-cash`).classList.add('debt');
    } else {
        document.getElementById(`${prefix}-cash`).classList.remove('debt');
    }
}

</script>

</body>
</html>
